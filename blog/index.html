<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Imagineoff/luna/main/Lunalogo.png">
    <title>Luna</title>
    <style>
        :root { --bg: #000; --txt: #e0e0e0; --acc: #333; }
        body { background: var(--bg); color: var(--txt); font-family: 'Courier New', monospace; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 600px; }
        header { width: 100%; margin-bottom: 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--acc); padding-bottom: 10px; }
        h1 { font-size: 1.5rem; margin: 0; letter-spacing: 2px; }
        #lgn { font-size: 0.8rem; color: var(--acc); cursor: pointer; }
        #ia { display: none; background: #111; padding: 15px; border: 1px solid var(--acc); margin-bottom: 30px; }
        textarea { width: 100%; background: transparent; border: none; color: var(--txt); font-family: inherit; resize: vertical; min-height: 60px; outline: none; font-size: 1rem; }
        .ab { display: flex; justify-content: flex-end; margin-top: 10px; }
        button { background: var(--txt); color: var(--bg); border: none; padding: 5px 15px; cursor: pointer; font-weight: bold; }
        .pst { display: flex; gap: 15px; margin-bottom: 25px; }
        .pfp { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 2px solid #222; }
        .cnt { flex-grow: 1; }
        .mt { font-size: 0.75rem; color: #666; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .txt { line-height: 1.5; white-space: pre-wrap; }
        .del { cursor: pointer; color: #444; }
        .del:hover { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Luna</h1>
            <span id="lgn">login</span>
        </header>
        <div id="ia">
            <textarea id="pt" placeholder="..."></textarea>
            <div class="ab"><button onclick="send()">+</button></div>
        </div>
        <div id="pc"></div>
    </div>
    <script>
        let k = null; 
        let r = null;
        const t = ["Luna", "Official Dev Blog"];
        let ti = 0, ci = 0, id = false;

        function tw() {
            const c = t[ti];
            document.title = id ? c.substring(0, ci--) : c.substring(0, ci++);
            let s = id ? 100 : 200;
            if (!id && ci > c.length) { s = 2000; id = true; }
            else if (id && ci === 0) { id = false; ti = (ti + 1) % t.length; s = 500; }
            setTimeout(tw, s);
        }
        tw();

        document.getElementById('lgn').onclick = async () => {
            const p = prompt("Password:");
            if (!p) return;
            const res = await fetch('/api/blog', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'login', password: p })
            });
            const d = await res.json();
            if (d.success) { k = p; r = d.role; ui(); }
        };

        function ui() {
            if (r) {
                document.getElementById('ia').style.display = 'block';
                document.getElementById('lgn').style.display = 'none';
            }
            load();
        }

        async function load() {
            const res = await fetch('/api/blog');
            const data = await res.json();
            const cont = document.getElementById('pc');
            cont.innerHTML = '';
            data.forEach(p => {
                let img = 'https://raw.githubusercontent.com/Imagineoff/luna/main/Lunalogo.png';
                if(p.roleType === 'admin') img = 'https://raw.githubusercontent.com/Imagineoff/luna/main/Imagine.jpg';
                else if(p.roleType === 'manager1') img = 'https://raw.githubusercontent.com/Imagineoff/luna/main/Storm.JPG';
                else if(p.roleType === 'manager2') img = 'https://raw.githubusercontent.com/Imagineoff/luna/main/Potato.PNG';
                
                cont.innerHTML += `
                    <div class="pst">
                        <img src="${img}" class="pfp">
                        <div class="cnt">
                            <div class="mt">
                                <span>${new Date(p.timestamp).toLocaleString()}</span>
                                ${r === 'admin' ? `<span class="del" onclick="rem('${p.id}')">âœ–</span>` : ''}
                            </div>
                            <div class="txt">${p.text}</div>
                        </div>
                    </div>`;
            });
        }

        async function send() {
            const v = document.getElementById('pt').value;
            if (!v.trim()) return;
            await fetch('/api/blog', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'post', password: k, text: v })
            });
            document.getElementById('pt').value = '';
            load();
        }

        async function rem(id) {
            if (!confirm("Delete?")) return;
            await fetch('/api/blog', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'delete', password: k, id: id })
            });
            load();
        }
        load();
    </script>
</body>
</html>
