<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>LUNA</title>
    <style>
        /* --- GENERAL SETTINGS --- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #000;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            user-select: none;
            cursor: none; /* keep hidden cursor for atmosphere; buttons override this */
        }

        /* INTRO */
        #intro-layer {
            position: fixed;
            inset: 0;
            display:flex;
            justify-content:center;
            align-items:center;
            background:#000;
            z-index:2000;
            transition:opacity .8s ease;
            cursor:default;
        }
        #enter-btn {
            border:1px solid #fff;
            background:transparent;
            color:#fff;
            padding:14px 36px;
            font-size:1.4rem;
            text-transform:uppercase;
            letter-spacing:4px;
            cursor:pointer;
        }
        #enter-btn:hover { background:#fff; color:#000; }

        /* CONTENT */
        #content-layer {
            position:fixed;
            inset:0;
            display:flex;
            justify-content:center;
            align-items:center;
            z-index:1;
            opacity:0;
            transition:opacity .8s ease;
        }

        /* center wrapper for timer + button */
        #center-wrap {
            display:flex;
            flex-direction:column;
            gap:18px;
            align-items:center;
            pointer-events:auto; /* ensure buttons are clickable (spotlight has pointer-events:none) */
            z-index:2;
        }

        #timer { color:#fff; font-size:4.2rem; letter-spacing:4px; }

        /* PLAY BUTTON */
        #play-btn {
            border: 2px solid rgba(255,255,255,0.85);
            background: rgba(255,255,255,0.02);
            color: #fff;
            padding: 12px 28px;
            font-size: 1.1rem;
            text-transform:uppercase;
            letter-spacing:3px;
            cursor: pointer; /* override body cursor:none */
            transition: transform .12s ease, background .18s ease, color .18s ease;
            backdrop-filter: blur(4px);
        }
        #play-btn:hover {
            transform: translateY(-3px);
            background: rgba(255,255,255,0.95);
            color: #000;
        }

        /* keep enter btn and play btn showing cursor even though body cursor is none */
        #enter-btn, #play-btn { cursor: pointer; }

        /* SPOTLIGHT */
        #spotlight-overlay {
            position:fixed;
            inset:0;
            pointer-events:none;
            z-index:10;
            opacity:0;
            transition:opacity .8s ease;
            /* gradient uses CSS variables set from JS: --x, --y, --r, --soft */
            background:
              radial-gradient(
                circle var(--r, 300px) at var(--x, 50%) var(--y, 50%),
                rgba(255,255,255,0) 0%,
                rgba(0,0,0,0.92) 38%,
                black 100%
              );
            will-change: background;
        }

        @media (max-width:768px){
            #timer { font-size:2.2rem; }
            #play-btn { padding: 10px 20px; font-size:1rem; }
            #enter-btn { padding: 10px 24px; font-size:1.1rem; }
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="https://files.catbox.moe/95ya6n.mp3" type="audio/mp3">
    </audio>

    <div id="intro-layer">
        <button id="enter-btn">ENTER</button>
    </div>

    <div id="spotlight-overlay"></div>

    <div id="content-layer">
        <div id="center-wrap" aria-live="polite">
            <div id="timer">Loading...</div>
            <button id="play-btn" aria-label="Play a game">VIEW THE GAME</button>
        </div>
    </div>

    <script>
    /*
      Nastavení: upravuj tady
    */
    const targetDateString = "2026-03-07T15:00:00";

    // Movement tuning
    const SETTINGS = {
        baseSpeed: 180,           // px/s (průměrná rychlost)
        minTargetTime: 800,       // ms - min doba než si vybere nový cílový bod
        maxTargetTime: 2600,      // ms - max doba
        reachThreshold: 40,       // px - když jsme blízko cíle, vybere se nový
        radiusMin: 200,           // px - spotlight radius min
        radiusMax: 420,           // px - spotlight radius max
        jitter: 14,               // px - drobný náhodný jitter pro organic pohyb
        changeRadiusEvery: 1200   // ms - jak často míchat velikost spotu
    };

    // Elements
    const introLayer = document.getElementById('intro-layer');
    const enterBtn = document.getElementById('enter-btn');
    const audio = document.getElementById('bg-music');
    const contentLayer = document.getElementById('content-layer');
    const spotlightOverlay = document.getElementById('spotlight-overlay');
    const timerElement = document.getElementById('timer');
    const playBtn = document.getElementById('play-btn');

    // Countdown
    function updateCountdown(){
        const now = Date.now();
        const target = new Date(targetDateString).getTime();
        const d = target - now;
        if (d <= 0) {
            timerElement.textContent = "00d 00h 00m 00s";
            return;
        }
        const days = Math.floor(d / (1000*60*60*24));
        const hours = Math.floor((d % (1000*60*60*24)) / (1000*60*60));
        const minutes = Math.floor((d % (1000*60*60)) / (1000*60));
        const seconds = Math.floor((d % (1000*60)) / 1000);
        const pad = n => (n<10 ? "0"+n : n);
        timerElement.textContent = `${pad(days)}d ${pad(hours)}h ${pad(minutes)}m ${pad(seconds)}s`;
    }
    setInterval(updateCountdown, 1000);
    updateCountdown();

    // Start interaction
    enterBtn.addEventListener('click', () => {
        // try play audio (may be blocked by browser)
        audio.volume = 0.5;
        audio.play().catch(()=>{ /* ignore */ });

        introLayer.style.opacity = '0';
        setTimeout(()=>{
            introLayer.style.display = 'none';
            contentLayer.style.opacity = '1';
            spotlightOverlay.style.opacity = '1';
            startSpotlight();
        }, 700);
    });

    // Play button: navigate in the same tab to itch game page
    playBtn.addEventListener('click', () => {
        // simple navigation in same window:
        window.location.href = 'https://studio-luna.itch.io/priceofpain';
    });

    // Spotlight physics (steering to random targets)
    let vw = window.innerWidth;
    let vh = window.innerHeight;

    let pos = { x: vw/2, y: vh/2 }; // current position (px)
    let target = randomPoint();
    let currentSpeed = SETTINGS.baseSpeed * (0.7 + Math.random()*0.9);
    let lastTime = performance.now();

    // radius animation
    let radius = (SETTINGS.radiusMin + SETTINGS.radiusMax) / 2;
    let lastRadiusChange = performance.now();

    // pick a random target timer (so it occasionally re-chooses even if not reached)
    let nextTargetTimeout = randomInt(SETTINGS.minTargetTime, SETTINGS.maxTargetTime);
    let targetTimer = 0;

    function randomInt(min, max){ return Math.floor(min + Math.random()*(max-min)); }
    function randomPoint(){
        return {
            x: Math.random() * vw,
            y: Math.random() * vh
        };
    }

    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

    function startSpotlight(){
        // set initial CSS vars
        spotlightOverlay.style.setProperty('--x', pos.x + 'px');
        spotlightOverlay.style.setProperty('--y', pos.y + 'px');
        spotlightOverlay.style.setProperty('--r', radius + 'px');

        lastTime = performance.now();
        requestAnimationFrame(loop);
    }

    function loop(t){
        const dt = Math.min(40, t - lastTime) / 1000; // limit dt to avoid huge jumps (s)
        lastTime = t;

        // if reached target or timeout, pick a new one
        const dx = target.x - pos.x;
        const dy = target.y - pos.y;
        const dist = Math.hypot(dx, dy);

        targetTimer += dt*1000;
        if (dist < SETTINGS.reachThreshold || targetTimer > nextTargetTimeout) {
            target = randomPoint();
            currentSpeed = SETTINGS.baseSpeed * (0.5 + Math.random()*1.2);
            nextTargetTimeout = randomInt(SETTINGS.minTargetTime, SETTINGS.maxTargetTime);
            targetTimer = 0;
        }

        // directional movement towards target with easing
        if (dist > 1) {
            const dirx = dx / dist;
            const diry = dy / dist;

            // Move: speed * dt, plus small jitter for organic feel
            const moveX = dirx * currentSpeed * dt;
            const moveY = diry * currentSpeed * dt;

            // small frame-stable jitter
            const jitterX = (Math.random() - 0.5) * SETTINGS.jitter * dt;
            const jitterY = (Math.random() - 0.5) * SETTINGS.jitter * dt;

            pos.x += moveX + jitterX;
            pos.y += moveY + jitterY;
        } else {
            // tiny random drift if exactly on target
            pos.x += (Math.random() - 0.5) * 10 * dt;
            pos.y += (Math.random() - 0.5) * 10 * dt;
        }

        // keep inside bounds
        pos.x = clamp(pos.x, 0, vw);
        pos.y = clamp(pos.y, 0, vh);

        // occasionally change radius for dynamic effect
        if (t - lastRadiusChange > SETTINGS.changeRadiusEvery) {
            lastRadiusChange = t;
            const newR = SETTINGS.radiusMin + Math.random() * (SETTINGS.radiusMax - SETTINGS.radiusMin);
            // smooth transition of radius with a small tween
            animateRadius(radius, newR, 450);
        }

        // set CSS variables
        spotlightOverlay.style.setProperty('--x', pos.x + 'px');
        spotlightOverlay.style.setProperty('--y', pos.y + 'px');
        spotlightOverlay.style.setProperty('--r', Math.round(radius) + 'px');

        requestAnimationFrame(loop);
    }

    // small tween for radius to keep it smooth
    function animateRadius(from, to, duration){
        const start = performance.now();
        function tick(now){
            const p = Math.min(1, (now - start) / duration);
            // ease in-out
            const eased = p < 0.5 ? 2*p*p : -1 + (4 - 2*p)*p;
            radius = from + (to - from) * eased;
            if (p < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
    }

    // update vw/vh on resize and clamp positions/target
    window.addEventListener('resize', () => {
        vw = window.innerWidth;
        vh = window.innerHeight;
        pos.x = clamp(pos.x, 0, vw);
        pos.y = clamp(pos.y, 0, vh);
        target.x = clamp(target.x, 0, vw);
        target.y = clamp(target.y, 0, vh);
    });

    // Optional: show spotlight on mouse (debug) - un-comment if you want manual control
    /*
    window.addEventListener('mousemove', (e)=>{
        pos.x = e.clientX;
        pos.y = e.clientY;
        // disable pointer hiding if necessary:
        // document.body.style.cursor = 'default';
    });
    */

    </script>
</body>
</html>
